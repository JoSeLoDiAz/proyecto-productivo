<template>
  <div class="container">
    <img class="imagenfondosena" src="../assets/iconosena.jpg" alt="fondo" />

    <div class="box">
      <!-- Login Box -->
      <div class="box-login" :style="{ left: loginLeft }">
        <div class="top-header">
          <p class="titulo">Software</p>
          <svg
            style="width: 40px; height: 40px"
            xmlns:dc="http://purl.org/dc/elements/1.1/"
            xmlns:cc="http://creativecommons.org/ns#"
            xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
            xmlns:svg="http://www.w3.org/2000/svg"
            xmlns="http://www.w3.org/2000/svg"
            xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
            xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
            viewBox="0 0 74.999997 73.5"
            version="1.1"
            id="svg12"
            sodipodi:docname="SENA logo.svg"
            inkscape:version="0.92.4 (5da689c313, 2019-01-14)"
          >
            <title id="title222">SENA Colombia logo</title>
            <metadata id="metadata18">
              <rdf:RDF>
                <cc:Work rdf:about="">
                  <dc:format>image/svg+xml</dc:format>
                  <dc:type
                    rdf:resource="http://purl.org/dc/dcmitype/StillImage"
                  />
                  <dc:title>SENA Colombia logo</dc:title>
                </cc:Work>
              </rdf:RDF>
            </metadata>
            <defs id="defs16">
              <pattern
                y="0"
                x="0"
                height="6"
                width="6"
                patternUnits="userSpaceOnUse"
                id="EMFhbasepattern"
              />
              <pattern
                y="0"
                x="0"
                height="6"
                width="6"
                patternUnits="userSpaceOnUse"
                id="EMFhbasepattern-0"
              />
            </defs>
            <sodipodi:namedview
              pagecolor="#ffffff"
              bordercolor="#666666"
              borderopacity="1"
              objecttolerance="1"
              gridtolerance="1"
              guidetolerance="1"
              inkscape:pageopacity="0"
              inkscape:pageshadow="2"
              inkscape:window-width="1366"
              inkscape:window-height="705"
              id="namedview14"
              showgrid="false"
              units="px"
              inkscape:showpageshadow="false"
              inkscape:zoom="1"
              inkscape:cx="96.265104"
              inkscape:cy="56.747294"
              inkscape:window-x="-8"
              inkscape:window-y="-8"
              inkscape:window-maximized="1"
              inkscape:current-layer="svg12"
            >
              <inkscape:grid type="xygrid" id="grid58" />
            </sodipodi:namedview>
            <g id="#ffffffff" transform="translate(0,-130.5)" />
            <path
              :style="{ fill: coloroficialcuatro }"
              d="M 37.729312,0.76709211 A 7.9671225,7.9671225 0 0 0 29.773371,8.741545 7.9671225,7.9671225 0 0 0 37.744605,16.701107 7.9671225,7.9671225 0 0 0 45.707788,8.733898 V 8.718608 A 7.9671225,7.9671225 0 0 0 37.729312,0.76709211 Z M 11.446982,19.169553 c -1.400062,0.0084 -2.8234862,0.08599 -4.1584857,0.42261 -0.8795905,0.222694 -1.7315449,0.589234 -2.2841086,1.159562 -0.6939573,0.71469 -0.7830516,1.683375 -0.4447463,2.510708 0.3027378,0.728932 1.116412,1.275934 2.0228936,1.588612 1.9500175,0.668079 4.117455,0.809612 6.168096,1.230399 0.378207,0.09257 0.796556,0.194498 1.030766,0.452796 0.242885,0.306852 0.09871,0.729986 -0.299446,0.922901 -0.666204,0.338572 -1.517067,0.341289 -2.29256,0.329636 -0.708709,-0.02913 -1.4860247,-0.08878 -2.0498634,-0.44354 -0.4146382,-0.255061 -0.487253,-0.689278 -0.3944343,-1.062161 l -4.5714374,4.13e-4 c -0.012144,0.695917 0.1230528,1.422157 0.6331108,2.019674 0.4259168,0.510124 1.1138561,0.869443 1.8546552,1.08631 1.1823274,0.347635 2.4633397,0.45247 3.7246061,0.484191 1.711468,0.02913 3.456086,-0.02172 5.099895,-0.410133 0.979349,-0.238231 1.942311,-0.624278 2.569473,-1.250927 1.113798,-1.117998 0.851643,-2.888599 -0.629086,-3.758011 -0.737329,-0.429203 -1.620362,-0.695805 -2.52077,-0.867357 -1.316781,-0.273188 -2.657724,-0.472977 -3.991855,-0.693081 -0.468421,-0.09127 -0.9637641,-0.17183 -1.3575867,-0.393229 -0.4120347,-0.221399 -0.4451988,-0.742521 -0.025355,-0.970393 0.5430207,-0.306203 1.2665147,-0.304035 1.9162377,-0.304681 0.68528,0.01165 1.430476,0.05483 1.994315,0.375921 0.31575,0.17673 0.442485,0.473443 0.445955,0.758283 l 4.344837,-0.01004 c -0.01734,-0.550925 -0.118731,-1.123123 -0.521227,-1.598289 -0.466686,-0.585218 -1.287477,-0.954052 -2.13237,-1.169625 -1.325457,-0.335334 -2.741002,-0.404061 -4.131515,-0.410535 z m 9.425817,0.328831 -0.0019,10.38132 12.670256,4.12e-4 -0.0011,-2.263178 H 25.518157 V 25.60169 h 7.154592 v -2.212465 h -7.154592 l -0.0016,-1.652607 7.734167,-0.002 -0.0044,-2.236213 z m 20.874932,0.0036 c 0,0 -3.91491,0.0012 -5.871868,0.0012 l -8.25e-4,10.382125 4.448274,4.12e-4 -0.0028,-6.986351 6.093235,6.980716 6.104905,0.0056 -0.0016,-10.382527 -4.451897,7.97e-4 0.0052,6.936443 z m 18.702713,0.01731 c 0,0 -4.795135,6.925757 -7.204899,10.383332 l 4.669239,4.12e-4 1.120118,-1.873169 h 7.21456 l 1.045256,1.873974 5.186434,-7.96e-4 -6.872848,-10.382125 z m 2.333214,2.478105 2.214074,3.76083 -4.576669,0.0065 z m -62.26819489,10.81881 0.0402459,5.651707 21.11883799,-0.07527 c 1.07706,0.231841 1.7024,0.932964 1.482355,2.526807 l -12.989427,22.73807 4.231335,3.955631 20.118662,-34.796918 z m 40.29930289,0.0483 19.784196,34.649208 4.372205,-3.930275 -13.14036,-22.678472 c -0.22011,-1.598763 0.405444,-2.307963 1.482759,-2.540491 l 21.123264,0.07527 -0.0056,-5.557928 z m -3.337814,5.733814 -18.552992,31.845491 4.928038,2.401635 12.380065,-20.924035 c 0.426522,-0.348923 0.858497,-0.534847 1.290772,-0.552212 0.455325,-0.01744 0.916655,0.151004 1.377709,0.511558 l 12.351487,20.988033 5.083398,-2.65158 z"
              id="path47-5"
              inkscape:connector-curvature="0"
            />
            <g
              id="#000000ff-2"
              transform="matrix(0.31570611,0,0,0.23560774,-391.49698,-10.601126)"
              style="fill: #ff6719; fill-opacity: 1"
            />
            |
          </svg>
        </div>

        <div class="input-group">
          <div class="input-field">
            <input
              type="text"
              class="input-box"
              id="logEmail"
              required
              v-model="loginEmail"
              @keyup.enter="inicioAdmin()"
            />
            <label for="logEmail">N° Identificación</label>
          </div>

          <div class="input-field">
            <input
              :type="showLogPassword ? 'text' : 'password'"
              class="input-box"
              id="logPassword"
              required
              v-model="loginPassword"
              @keyup.enter="inicioAdmin"
            />
            <label for="logPassword">Contraseña</label>

            <div class="password-toggle">
              <img
                style="height: 35px; width: 35px; padding: 5px"
                @click="toggleLogPasswordVisibility"
                v-if="showLogPassword"
                src="../assets/ver.png"
                alt=""
              />
              <img
                style="height: 35px; width: 35px; padding: 5px"
                @click="toggleLogPasswordVisibility"
                v-else
                src="../assets/nover.png"
                alt=""
              />
            </div>
          </div>

          <div class="input-field">
            <router-link
              @click="inicioAdmin()"
              :to="inicio"
              id="liveToastBtn"
              class="btn"
              :style="{
                backgroundColor: coloroficialmenu,
                color: coloroficialtres,
              }"
              v-if="useUsuario.cargando == false"
            >
              Iniciar sesión
            </router-link>

            <div v-else class="lds-facebook">
              <div></div>
              <div></div>
              <div></div>
            </div>

            <br />
            <br />
          </div>
        </div>

        <div class="switch">
          <a href="#" class="login" @click="switchToLogin">Iniciar sesion</a>
          <a href="#" class="register" @click="switchToRegister"
            >Recuperar contra</a
          >
        </div>
      </div>
      <!-- Register -->
      <div class="box-register" :style="{ right: registerRight }">
        <div class="top-header">
          <p class="titulo2">Recupera tu contraseña</p>
        </div>
        <div class="input-group">
          <div class="input-field">
            <input
              type="text"
              class="input-box"
              id="regUser"
              required
              v-model="regUser"
            />
            <label for="regUser">Ingresa tu correo electronico</label>
          </div>

          <div class="input-field">
            <div
            v-if="useUsuario.cargando === true"
            class="row d-flex justify-content-center"
          >
            <div class="spinner-border" :style="{
                color: coloroficialtres,
              }" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
          <button v-else
              :style="{
                backgroundColor: coloroficialmenu,
                color: coloroficialtres,
              }"
              class="btn"
              @click="envioEmail()"
            >
              Recuperar contraseña
            </button>
          </div>

          <div class="switch2">
            <a href="#" class="login" @click="switchToLogin">Iniciar sesion</a>
            <a href="#" class="register" @click="switchToRegister"
              >Recuperar contraseña</a
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, onMounted } from "vue";

let loginEmail = ref("");
let loginPassword = ref("");
const rememberMe = ref(false);
let regUser = ref("");
const regEmail = ref("");
const regPassword = ref("");
const rememberMeReg = ref(false);
const showLogPassword = ref(false);
const showRegPassword = ref(false);
const loginLeft = ref("27px");
const registerRight = ref("-350px");
const switchBtnLeft = ref("0px");
import { useRouter } from "vue-router";
import { useUsuarioStore } from "../stores/usuario.js";
let alert = ref(false);
let inicio = ref("");
let errores = ref("");
const useUsuario = useUsuarioStore();
const router = useRouter();
let ok = ref("");
let pageTitle = ref("");

const setDocumentTitle = () => {
  pageTitle.value = "Login"; // Título predeterminado aquí
  document.title = `Legado Sena || ${pageTitle.value}`;
  console.log(document.title);
};

const toggleLogPasswordVisibility = () => {
  showLogPassword.value = !showLogPassword.value;
};

const switchToLogin = () => {
  loginLeft.value = "27px";
  registerRight.value = "-350px";
  switchBtnLeft.value = "0px";
};

const switchToRegister = () => {
  loginLeft.value = "-350px";
  registerRight.value = "25px";
  switchBtnLeft.value = "150px";
};

async function inicioAdmin() {
  await useUsuario
    .inicio(loginEmail.value, loginPassword.value)
    .then(() => {
      alertaok();
      // sessionStorage.setItem("token", token);
      // axios.defaults.headers.common["Authorization"] = `Bearer ${token}`;
      inicio.value = "/inicio";
      router.push(inicio.value);
      limpiar();
    })
    .catch((error) => {
      console.log(error);
      if (error.response.data.errors) {
        errores.value = "";
        errores.value = error.response.data.errors[0].msg;
        alertaerror();
      } else if (error.response.data.msg) {
        errores.value = "";
        errores.value = error.response.data.msg;
        alertaerror();
      }
    });
}

async function envioEmail() {
  await useUsuario
    .recuperaPassword(regUser.value)
    .then((res) => {
      ok.value = res.data.msg;
      alertaokok();
    })
    .catch((err) => {
      if (err.response.data.errors) {
        errores.value = "";
        errores.value = err.response.data.errors[0].msg;
        alertaerror();
      } else if (err.response.data.msg) {
        errores.value = "";
        errores.value = err.response.data.msg;
        alertaerror();
      }
    });
}

function limpiar() {
  loginEmail.value = "";
  loginPassword.value = "";
  errores.value = "";
}

function alertaok() {
  Swal.fire({
    icon: "success",
    confirmButtonColor: coloroficialmenu.value,
    title: "Inicio de sesion exitoso.",
    text: "Bienvenido al software sena!",
    timer: 1000,
  });
}

function alertaokok() {
  Swal.fire({
    icon: "success",
    confirmButtonColor: coloroficialmenu.value,
    title: ok.value,
    text: "software sena!",
    timer: 4000,
  });
}

function alertaerror() {
  Swal.fire({
    icon: "error",
    confirmButtonColor: coloroficialmenu.value,
    color: coloroficialmenu.value,
    title: "Oops...",
    text: errores.value,
  });
}

onMounted(async () => {
  setDocumentTitle(), await traigodatos();
});

import { useConfiguracionStore } from "../stores/configuracion.js";
const useConfiguracion = useConfiguracionStore();
let coloroficialmenu = ref();
let coloroficialletra = ref();
let coloroficialtres = ref();
let coloroficialcuatro = ref();
async function traigodatos() {
  await useConfiguracion
    .traerConfiguracion()
    .then((resultado) => {
      coloroficialmenu.value = resultado[0].colormenu;
      coloroficialletra.value = resultado[0].colorletra;
      coloroficialtres.value = resultado[0].colortres;
      coloroficialcuatro.value = resultado[0].colorcuatro;
    })
    .catch((error) => {
      console.error("Hubo un error:", error);
    });
}
</script>

<style scoped>
@import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&display=swap");
.lds-facebook {
  display: inline-block;
  position: relative;
  width: 50px;
  height: 30px;
}
.lds-facebook div {
  display: inline-block;
  position: absolute;
  left: 8px;
  width: 16px;
  background: #fff;
  animation: lds-facebook 1.2s cubic-bezier(0, 0.5, 0.5, 1) infinite;
}
.lds-facebook div:nth-child(1) {
  left: 8px;
  animation-delay: -0.24s;
}
.lds-facebook div:nth-child(2) {
  left: 32px;
  animation-delay: -0.12s;
}
.lds-facebook div:nth-child(3) {
  left: 56px;
  animation-delay: 0;
}
@keyframes lds-facebook {
  0% {
    top: 8px;
    height: 64px;
  }
  50%,
  100% {
    top: 24px;
    height: 32px;
  }
}

.container {
  display: flex;
  justify-content: center; /* Centra horizontalmente */
  align-items: center; /* Centra verticalmente */
  height: 100vh;
  width: 100vw;
}

.imagenfondosena {
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  position: fixed;
  filter: blur(2px);
  z-index: -1;
}
.titulo {
  font-size: 35px;
  font-weight: 600;
  margin-right: 10px;
}

.titulo2 {
  font-size: 30px;
  font-weight: 600;
}

.box {
  display: flex;
  flex-direction: row;
  position: relative;
  padding: 60px 20px 30px 20px;
  height: 520px;
  width: 400px;
  background-color: rgba(221, 234, 228, 0.4);
  border-radius: 30px;
  -webkit-backdrop-filter: blur(15px);
  backdrop-filter: blur(15px);
  border: 3px solid rgba(255, 255, 255, 0.2);
  overflow: hidden;
}
.box-login {
  position: absolute;
  width: 85%;
  left: 27px;
  transition: 0.5s ease-in-out;
}
.box-register {
  position: absolute;
  width: 85%;
  right: -350px;
  transition: 0.5s ease-in-out;
}
.top-header {
  text-align: center;
  margin: 30px 0;
  display: flex;
  align-content: center;
  align-items: center;
  justify-content: center;
}
.top-header h3 {
  font-size: 22px;
  font-weight: 600;
  margin-bottom: 8px;
}
.input-group {
  width: 100%;
  justify-content: center;
  align-content: center;
  align-items: center;
}
.input-field {
  margin: 12px 0;
  position: relative;
}
.input-box {
  width: 20rem;
  margin-right: 10px;
  margin-left: 10px;
  height: 50px;
  font-size: 15px;
  color: #040404;
  border: none;
  border-radius: 10px;
  padding: 7px 45px 0 20px;
  background: rgba(224, 223, 223, 0.6);
  backdrop-filter: blur(2px);
  outline: none;
}
.input-field label {
  position: absolute;
  left: 20px;
  top: 15px;
  font-size: 15px;
  transition: 0.3s ease-in-out;
}
.input-box:focus ~ label,
.input-box:valid ~ label {
  top: 2px;
  font-size: 10px;
  color: #000000;
  font-weight: 500;
}
.eye-area {
  position: absolute;
  top: 20px;
  right: 40px;
}
.eye-box {
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
}
i {
  position: absolute;
  color: #444444;
  cursor: pointer;
}
#eye,
#eye-2 {
  opacity: 1;
}
#eye-slash,
#eye-slash-2 {
  opacity: 0;
}

.switch {
  display: flex;
  width: 85%;
  height: 50px;
  background: rgba(255, 255, 255, 0.16);
  backdrop-filter: blur(10px);
  border-radius: 10px;
  box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
  margin-top: 10%;
  margin-right: 20px;
  position: fixed;
}

.password-toggle {
  position: absolute;
  right: 10px; /* Ajusta el espaciado a tu preferencia */
  top: 50%; /* Centra verticalmente */
  transform: translateY(-50%);
}

.switch2 {
  display: flex;
  width: 85%;
  height: 50px;
  background: rgba(255, 255, 255, 0.16);
  backdrop-filter: blur(10px);
  border-radius: 10px;
  box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
  margin-top: 120%;
  position: fixed;
}

.switch a {
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 14px;
  font-weight: 500;
  color: #000;
  text-decoration: none;
  width: 50%;
  border-radius: 10px;
  z-index: 10;
}
.switch2 a {
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 14px;
  font-weight: 500;
  color: #000;
  text-decoration: none;
  width: 50%;
  border-radius: 10px;
  z-index: 10;
}
</style>
