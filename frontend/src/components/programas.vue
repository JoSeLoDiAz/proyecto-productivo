<template>
  <div id="app">
    <div class="row">
      <div
        class="row"
        style="
          background-color: rgb(223, 223, 223);
          left: 29px;
          position: relative;
        "
      >
        <div
          class="row"
          style="margin-top: 80px; background-color: rgb(223, 223, 223)"
        ></div>
        <div class="row" style="background-color: rgb(223, 223, 223)">
          <div class="col-12 d-flex justify-content-center align-items-center">
            <h5 class="titulo" style="bottom: 25px; position: relative">
              Red {{ useUsuarios.usuarioId.red.nombre }} <br />
            </h5>
            <svg
              class="logo"
              xmlns:dc="http://purl.org/dc/elements/1.1/"
              xmlns:cc="http://creativecommons.org/ns#"
              xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
              xmlns:svg="http://www.w3.org/2000/svg"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
              xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
              width="100"
              height="98"
              viewBox="0 0 74.999997 73.5"
              version="1.1"
              id="svg12"
              sodipodi:docname="SENA logo.svg"
              inkscape:version="0.92.4 (5da689c313, 2019-01-14)"
            >
              <title id="title222">SENA Colombia logo</title>
              <metadata id="metadata18">
                <rdf:RDF>
                  <cc:Work rdf:about="">
                    <dc:format>image/svg+xml</dc:format>
                    <dc:type
                      rdf:resource="http://purl.org/dc/dcmitype/StillImage"
                    />
                    <dc:title>SENA Colombia logo</dc:title>
                  </cc:Work>
                </rdf:RDF>
              </metadata>
              <defs id="defs16">
                <pattern
                  y="0"
                  x="0"
                  height="6"
                  width="6"
                  patternUnits="userSpaceOnUse"
                  id="EMFhbasepattern"
                />
                <pattern
                  y="0"
                  x="0"
                  height="6"
                  width="6"
                  patternUnits="userSpaceOnUse"
                  id="EMFhbasepattern-0"
                />
              </defs>
              <sodipodi:namedview
                pagecolor="#ffffff"
                bordercolor="#666666"
                borderopacity="1"
                objecttolerance="1"
                gridtolerance="1"
                guidetolerance="1"
                inkscape:pageopacity="0"
                inkscape:pageshadow="2"
                inkscape:window-width="1366"
                inkscape:window-height="705"
                id="namedview14"
                showgrid="false"
                units="px"
                inkscape:showpageshadow="false"
                inkscape:zoom="1"
                inkscape:cx="96.265104"
                inkscape:cy="56.747294"
                inkscape:window-x="-8"
                inkscape:window-y="-8"
                inkscape:window-maximized="1"
                inkscape:current-layer="svg12"
              >
                <inkscape:grid type="xygrid" id="grid58" />
              </sodipodi:namedview>
              <g id="#ffffffff" transform="translate(0,-130.5)" />
              <path
                :style="{ fill: coloroficialcuatro }"
                d="M 37.729312,0.76709211 A 7.9671225,7.9671225 0 0 0 29.773371,8.741545 7.9671225,7.9671225 0 0 0 37.744605,16.701107 7.9671225,7.9671225 0 0 0 45.707788,8.733898 V 8.718608 A 7.9671225,7.9671225 0 0 0 37.729312,0.76709211 Z M 11.446982,19.169553 c -1.400062,0.0084 -2.8234862,0.08599 -4.1584857,0.42261 -0.8795905,0.222694 -1.7315449,0.589234 -2.2841086,1.159562 -0.6939573,0.71469 -0.7830516,1.683375 -0.4447463,2.510708 0.3027378,0.728932 1.116412,1.275934 2.0228936,1.588612 1.9500175,0.668079 4.117455,0.809612 6.168096,1.230399 0.378207,0.09257 0.796556,0.194498 1.030766,0.452796 0.242885,0.306852 0.09871,0.729986 -0.299446,0.922901 -0.666204,0.338572 -1.517067,0.341289 -2.29256,0.329636 -0.708709,-0.02913 -1.4860247,-0.08878 -2.0498634,-0.44354 -0.4146382,-0.255061 -0.487253,-0.689278 -0.3944343,-1.062161 l -4.5714374,4.13e-4 c -0.012144,0.695917 0.1230528,1.422157 0.6331108,2.019674 0.4259168,0.510124 1.1138561,0.869443 1.8546552,1.08631 1.1823274,0.347635 2.4633397,0.45247 3.7246061,0.484191 1.711468,0.02913 3.456086,-0.02172 5.099895,-0.410133 0.979349,-0.238231 1.942311,-0.624278 2.569473,-1.250927 1.113798,-1.117998 0.851643,-2.888599 -0.629086,-3.758011 -0.737329,-0.429203 -1.620362,-0.695805 -2.52077,-0.867357 -1.316781,-0.273188 -2.657724,-0.472977 -3.991855,-0.693081 -0.468421,-0.09127 -0.9637641,-0.17183 -1.3575867,-0.393229 -0.4120347,-0.221399 -0.4451988,-0.742521 -0.025355,-0.970393 0.5430207,-0.306203 1.2665147,-0.304035 1.9162377,-0.304681 0.68528,0.01165 1.430476,0.05483 1.994315,0.375921 0.31575,0.17673 0.442485,0.473443 0.445955,0.758283 l 4.344837,-0.01004 c -0.01734,-0.550925 -0.118731,-1.123123 -0.521227,-1.598289 -0.466686,-0.585218 -1.287477,-0.954052 -2.13237,-1.169625 -1.325457,-0.335334 -2.741002,-0.404061 -4.131515,-0.410535 z m 9.425817,0.328831 -0.0019,10.38132 12.670256,4.12e-4 -0.0011,-2.263178 H 25.518157 V 25.60169 h 7.154592 v -2.212465 h -7.154592 l -0.0016,-1.652607 7.734167,-0.002 -0.0044,-2.236213 z m 20.874932,0.0036 c 0,0 -3.91491,0.0012 -5.871868,0.0012 l -8.25e-4,10.382125 4.448274,4.12e-4 -0.0028,-6.986351 6.093235,6.980716 6.104905,0.0056 -0.0016,-10.382527 -4.451897,7.97e-4 0.0052,6.936443 z m 18.702713,0.01731 c 0,0 -4.795135,6.925757 -7.204899,10.383332 l 4.669239,4.12e-4 1.120118,-1.873169 h 7.21456 l 1.045256,1.873974 5.186434,-7.96e-4 -6.872848,-10.382125 z m 2.333214,2.478105 2.214074,3.76083 -4.576669,0.0065 z m -62.26819489,10.81881 0.0402459,5.651707 21.11883799,-0.07527 c 1.07706,0.231841 1.7024,0.932964 1.482355,2.526807 l -12.989427,22.73807 4.231335,3.955631 20.118662,-34.796918 z m 40.29930289,0.0483 19.784196,34.649208 4.372205,-3.930275 -13.14036,-22.678472 c -0.22011,-1.598763 0.405444,-2.307963 1.482759,-2.540491 l 21.123264,0.07527 -0.0056,-5.557928 z m -3.337814,5.733814 -18.552992,31.845491 4.928038,2.401635 12.380065,-20.924035 c 0.426522,-0.348923 0.858497,-0.534847 1.290772,-0.552212 0.455325,-0.01744 0.916655,0.151004 1.377709,0.511558 l 12.351487,20.988033 5.083398,-2.65158 z"
                id="path47-5"
                inkscape:connector-curvature="0"
              />
              <g
                id="#000000ff-2"
                transform="matrix(0.31570611,0,0,0.23560774,-391.49698,-10.601126)"
                style="fill: #ff6719; fill-opacity: 1"
              />
              |
            </svg>
          </div>
        </div>
      </div>

      <div class="row" style="margin: 30px 0">
        <div class="col-12 buscar">
          <input
            type="text"
            class="inputbuscar"
            @input="programa_filtrado"
            placeholder="Buscar por codigo"
          />
          <img class="imageninput" src="../assets/buscar.png" alt="" />

          <div
            style="margin-left: 100px"
            class="alert-vacio"
            v-if="vacio !== ''"
          >
            {{ vacio }}
          </div>

          <button
            v-if="useUsuarios.rol === 'Gestor'.toLowerCase()"
            type="button"
            class="btn botonguardar"
            data-bs-toggle="modal"
            data-bs-target="#staticBackdrop"
            @click="cambio('Agregar')"
          >
            Agregar +
          </button>
        </div>
      </div>
      <div class="row"></div>

      <div class="row" v-if="usePrograma.cargando == false">
        <div class="col-12">
          <div class="table-container">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Codigo</th>
                  <th>Nombre</th>
                  <th>Modalidad</th>
                  <th>Requisitos</th>
                  <th>Versión</th>
                  <th>Nivel formación</th>
                  <th>Estado</th>
                  <th>Desarrollo</th>
                  <th v-if="useUsuarios.rol === 'Gestor'.toLowerCase()">
                    instructores
                  </th>
                  <th v-if="useUsuarios.rol === 'Gestor'.toLowerCase()">
                    Editar
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="p in programasBuscados" :key="p">
                  <td>{{ p.codigo }}</td>
                  <td style="cursor: pointer">
                    {{ p.nombre }}
                  </td>
                  <td>{{ p.modalidad }}</td>
                  <td>{{ p.requisitos }}</td>
                  <td>{{ p.version }}</td>
                  <td>{{ p.nivel.denominacion }}</td>
                  <!-- <td>{{ p.red.nombre }}</td> -->
                  <td
                    style="cursor: pointer"
                    @click="cambiarEstado(p)"
                    v-if="useUsuarios.rol === 'Gestor'.toLowerCase()"
                  >
                    <span v-if="p.estado === true" style="color: green"
                      >Activo</span
                    >
                    <span v-else style="color: red">Inactivo</span>
                  </td>
                  <td v-else>
                    <span v-if="p.estado === true" style="color: green"
                      >Activo</span
                    >
                    <span v-else style="color: red">Inactivo</span>
                  </td>
                  <td>
                    <img
                      @click="buscarProgramaId(p)"
                      v-if="p.desarrollo"
                      style="cursor: pointer; width: 40px"
                      src="../assets/ojo.png"
                      alt=""
                    />

                    <button
                      @click="buscarProgramaId(p)"
                      v-else
                      type="button"
                      class="btn btn-success"
                      data-bs-toggle="modal"
                      data-bs-target="#modalDesarrollo"
                    >
                      <img
                        style="cursor: pointer; width: 20px"
                        src="../assets/agregar1.png"
                        alt=""
                      />
                    </button>
                  </td>
                  <td v-if="useUsuarios.rol === 'Gestor'.toLowerCase()">
                    <img
                      @click="agregarInstructor(p)"
                      style="cursor: pointer; width: 20px"
                      src="../assets/grupo.png"
                      alt=""
                    />
                  </td>
                  <td v-if="useUsuarios.rol === 'Gestor'.toLowerCase()">
                    <img
                      src="../assets/editar-usuario.png"
                      alt=""
                      data-bs-toggle="modal"
                      data-bs-target="#staticBackdrop"
                      @click="cambio('Editar'), editar(p)"
                      style="cursor: pointer; width: 20px"
                    />
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div v-else class="row d-flex justify-content-center">
        <div class="spinner-border text-success" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="staticBackdrop"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
      tabindex="-1"
      aria-labelledby="staticBackdropLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title" id="staticBackdropLabel">
              {{ msg_modal }}
            </h2>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="d-flex flex-row mb-2 flex-wrap">
              <div class="p-2">
                <span>Codigo</span>
                <input type="text" v-model="codigo" />
              </div>

              <div class="p-2">
                <span>Nombre</span>
                <input type="text" v-model="nombre" />
              </div>

              <div class="p-2">
                <span>Modalidad</span>
                <input type="text" v-model="modalidad" />
              </div>

              <div class="p-2">
                <span>Diseño curricular</span>
                <span class="disenoCurricular">
                  <input
                    type="file"
                    accept=".pdf, .doc, .docx"
                    @change="llevar"
                    id="disenoCurricular"
                    name="disenoCurricular"
                  />
                </span>
                <label for="disenoCurricular">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="iborrainputfile"
                    width="20"
                    height="17"
                    viewBox="0 0 20 17"
                  >
                    <path
                      d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"
                    ></path>
                  </svg>
                  <span style="margin: 0 10px" v-if="disenoCurricular === null"
                    >Diseño Curricular</span
                  >
                  <span style="margin: 0 10px" v-else>{{
                    disenoCurricular.name
                  }}</span>
                </label>
              </div>

              <div class="p-2">
                <span>Requisitos</span>
                <input type="text" v-model="requisitos" />
              </div>

              <div class="p-2">
                <span>version</span>
                <input type="text" v-model="version" />
              </div>

              <div class="p-2">
                <span>Nivel de formacion</span>
                <select name="nivel" id="nivel" v-model="nivelId">
                  <option value="" disabled selected v-if="msg_modal === 'Agregar Programa'">
                    Seleccione
                  </option>
                  <!-- <option value="" v-else>{{ niveles.nombre }}</option> -->
                  <option :value="n._id" v-for="n in niveles" :key="n">
                    {{ n.denominacion }}
                  </option>
                </select>
              </div>
            </div>
          </div>

          <div v-if="alert === true">
            <svg xmlns="http://www.w3.org/2000/svg" class="d-none alerta">
              <symbol id="exclamation-triangle-fill" viewBox="0 0 16 16">
                <path
                  d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"
                />
              </symbol>
            </svg>
            <div
              class="alert alert-warning d-flex align-items-center"
              role="alert"
            >
              <svg
                style="width: 20px; height: 20px"
                class="bi flex-shrink-0 me-2"
                role="img"
                aria-label="Warning:"
              >
                <use xlink:href="#exclamation-triangle-fill" />
              </svg>
              <div>
                {{ errores }}
              </div>
            </div>
          </div>

          <div class="modal-footer" style="margin: auto">
            <button
              type="button"
              class="btn btn-danger"
              :style="{ color: coloroficialtres }"
              data-bs-dismiss="modal"
              aria-label="Close"
              id="close"
            >
              Cancelar
            </button>

            <button
              v-if="msg_modal === 'Agregar Programa'"
              type="button"
              class="btn"
              :style="{
                backgroundColor: coloroficialmenu,
                color: coloroficialtres,
              }"
              @click="guardarPrograma()"
            >
              <div
                v-if="usePrograma.cargando === true"
                class="row d-flex justify-content-center p-1"
              >
                <div class="spinner-border text-ligth" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
              <span v-else>Agregar</span>
            </button>
            <button
              v-else
              type="button"
              class="btn"
              :style="{
                backgroundColor: coloroficialmenu,
                color: coloroficialtres,
              }"
              @click="guardarEdision()"
            >
              <div
                v-if="usePrograma.cargando === true"
                class="row d-flex justify-content-center p-1"
              >
                <div class="spinner-border text-ligth" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
              <span v-else>Editar</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- modal registrar desarrollo -->
    <div
      class="modal fade"
      id="modalDesarrollo"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
      tabindex="-1"
      aria-labelledby="modalDesarrolloLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h1
              style="color: white"
              class="modal-title fs-5"
              id="modalDesarrolloLabel"
            >
              Agregar Desarrollo Curricular
            </h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body d-flex flex-column">
            Este programa no tiene desarrollo curricular ¿Desea Crearlo?
          </div>

          <div v-if="alert === true">
            <svg xmlns="http://www.w3.org/2000/svg" class="d-none alerta">
              <symbol id="exclamation-triangle-fill" viewBox="0 0 16 16">
                <path
                  d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"
                />
              </symbol>
            </svg>
            <div
              class="alert alert-warning d-flex align-items-center"
              role="alert"
            >
              <svg
                style="width: 20px; height: 20px"
                class="bi flex-shrink-0 me-2"
                role="img"
                aria-label="Warning:"
              >
                <use xlink:href="#exclamation-triangle-fill" />
              </svg>
              <div>
                {{ errores }}
              </div>
            </div>
          </div>

          <div
            v-if="usePrograma.cargando === true"
            class="row d-flex justify-content-center"
          >
            <div class="spinner-border text-success" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>

          <div
            v-if="useRed.cargando === true"
            class="row d-flex justify-content-center"
          >
            <div class="spinner-border text-success" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>

          <div class="modal-footer" style="margin: auto">
            <button
              type="button"
              class="btn btn-danger"
              data-bs-dismiss="modal"
              aria-label="Close"
              id="close1"
            >
              Cancelar
            </button>
            <button
              type="button"
              class="btn btn-success"
              @click="registrarDesarrollo()"
            >
              Crear
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from "vue";
import { useProgramaStore } from "../stores/programa.js";
import { useRedStore } from "../stores/red.js";
import { useNivelStore } from "../stores/nivel.js";
import { useUsuarioStore } from "../stores/usuario.js";
import { useRouter } from "vue-router";

import VueJwtDecode from "vue-jwt-decode";

let token = ref(null);

const useUsuarios = useUsuarioStore();
const usePrograma = useProgramaStore();
const useNivel = useNivelStore();
const useRed = useRedStore();
const router = useRouter();

let programasBuscados = ref([]);
let buscado_v = ref("");
let vacio = ref("");
let msg_modal = ref("");
let id = ref("");
let codigo = ref("");
let nombre = ref("");
let modalidad = ref("");
let disenoCurricular = ref("");
let requisitos = ref("");
let version = ref("");
let niveles = ref([]);
let nivelId = ref("");
let red = ref("");
let usuarioId = ref("");
let ambienteId = ref("");
let alert = ref(false);
let errores = ref("");
let linkDesarrrollo = ref("");
let linkInstructores = ref("");
let newProgramas = ref([]);

const setDocumentTitle = () => {
  document.title = `Legado Sena || Programas`;
};

function cambio(msg) {
  if (msg == "Agregar") {
    buscarNivel();
    msg_modal.value = "Agregar Programa";
    limpiar();
  } else {
    msg_modal.value = "Editar Programa";
  }
}

function llevar(event) {
  disenoCurricular.value = event.target.files[0];
}

async function buscarProgramaId(p) {
  await usePrograma
    .buscarProgramaId(p._id)
    .then(() => {
      if (usePrograma.idPrograma.desarrollo) {
        linkDesarrrollo.value = "/infoprograma";
        router.push(linkDesarrrollo.value);
      }
    })
    .catch((err) => {
      console.log(err);
    });
}

async function agregarInstructor(p) {
  await usePrograma
    .buscarProgramaId(p._id)
    .then(() => {
      linkInstructores.value = "/instructor";
      router.push(linkInstructores.value);
    })
    .catch((err) => {
      console.log(err);
    });
}

async function buscarPrograma() {
  programasBuscados.value = [];
  if (useUsuarios.rol === "Gestor".toLowerCase()) {
    await useRed.buscarRedId(useUsuarios.red);
    await usePrograma
      .buscarPrograma()
      .then((res) => {
        for (let i = 0; i < res.length; i++) {
          if (res[i].red._id === useUsuarios.usuarioId.red._id) {
            programasBuscados.value.push(res[i]);
            newProgramas.value = [...programasBuscados.value];
          }
        }
      })
      .catch((err) => {
        console.log(err);
      });
  } else if (useUsuarios.rol === "Instructor".toLowerCase()) {
    token.value = VueJwtDecode.decode(useUsuarios.token);
    await useUsuarios.buscarUsuarioId(token.value.id);
    await usePrograma.buscarPrograma().then((res) => {
      for (let i = 0; i < res.length; i++) {
        const usuarioCumpleCondicion = res[i].usuario.filter(
          (usuario) => usuario._id === useUsuarios.usuarioId._id
        );

        if (usuarioCumpleCondicion.length > 0) {
          programasBuscados.value.push(res[i]);
          newProgramas.value = [...programasBuscados.value];
        }
      }
    });
  } else {
    await usePrograma.buscarPrograma().then((res) => {
      programasBuscados.value = res;
      newProgramas.value = [...programasBuscados.value];
    });
  }
}

async function buscarNivel() {
  await useNivel.buscarNivel().then((res) => {
    niveles.value = res;
  });
}

function validaciones(){
  if(codigo.value.trim()===''){
    alert.value = true;
        errores.value = 'Complete el campo Codigo';
        alerta();
  }else if(nombre.value.trim()===''){
    alert.value = true;
        errores.value = 'Complete el campo Nombre';
        alerta();
  }else if(modalidad.value.trim()===''){
    alert.value = true;
        errores.value = 'Complete el campo Modalidad';
        alerta();
  }else if(disenoCurricular.value.trim()===''){
    alert.value = true;
        errores.value = 'Falta el Archivo';
        alerta();
  }else if(requisitos.value.trim()===''){
    alert.value = true;
        errores.value = 'Complete el campo Requisitos';
        alerta();
  }else if(version.value.trim()===''){
    alert.value = true;
        errores.value = 'Complete el campo Versión';
        alerta();
  }else if(nivelId.value.trim()===''){
    alert.value = true;
        errores.value = 'Debe Seleccionar un Nivel de Formación';
        alerta();
  }else{
    return true;
  }
}

async function guardarPrograma() {
  if(validaciones()===true){
  await usePrograma
    .registrarPrograma({
      codigo: codigo.value,
      nombre: nombre.value.toLowerCase(),
      modalidad: modalidad.value.toLowerCase(),
      disenoCurricular: disenoCurricular.value,
      requisitos: requisitos.value.toLowerCase(),
      version: version.value.toLowerCase(),
      estado: true,
      nivel: nivelId.value,
      red: useRed.idRed._id,
    })
    .then(() => {
      buscarPrograma();
      ok();
      closeModal();
    })
    .catch((err) => {
      if (err.response && err.response.data.errors) {
        alert.value = true;
        errores.value = err.response.data.errors[0].msg;
        alerta();
      } else if (err.response && err.response.data.msg) {
        alert.value = true;
        errores.value = err.response.data.msg;
        alerta();
      } else if (err.response.data.error) {
        alert.value = true;
        errores.value = "Falta el archivo";
        alerta();
      }
    });
  }
}

async function registrarDesarrollo() {
  await usePrograma
    .registrarProgramaDesarrollo(usePrograma.idPrograma._id)
    .then(() => {
      ok();
      closeModal();
      buscarPrograma();
    })
    .catch((err) => {
      if (err.response && err.response.data.errors) {
        alert.value = true;
        errores.value = err.response.data.errors[0].msg;
        alerta();
      } else if (err.response && err.response.data.msg) {
        alert.value = true;
        errores.value = err.response.data.msg;
        alerta();
      } else if (err.response.data.error) {
        alert.value = true;
        console.log(err);
        errores.value = "Falta el archivo";
        alerta();
      }
    });
}

function programa_filtrado(event) {
  buscado_v.value = event.target.value;
  if (buscado_v.value === "") {
    buscarPrograma();
    vacio.value = "";
  } else {
    programasBuscados.value = newProgramas.value;
    let filtrado = programasBuscados.value.filter(
      (g) =>
        g.codigo.includes(buscado_v.value.toLowerCase()) ||
        g.nombre.includes(buscado_v.value.toLowerCase())
    );
    if (filtrado.length === 0) {
      programasBuscados.value = [];
      vacio.value = `Sin resultados para ${buscado_v.value}`;
    } else {
      vacio.value = "";
      programasBuscados.value = filtrado;
    }
  }
}

function editar(p) {
  buscarNivel();
  (id.value = p._id),
    (codigo.value = p.codigo),
    (nombre.value = p.nombre),
    (modalidad.value = p.modalidad),
    (disenoCurricular.value = p.disenoCurricular),
    (requisitos.value = p.requisitos),
    (version.value = p.version),
    (nivelId.value = p.nivel._id);
  red.value = p.red._id;
}

async function guardarEdision() {
  if(validaciones()===true){
  await usePrograma
    .editarPrograma(
      id.value,
      codigo.value.toLowerCase(),
      nombre.value.toLowerCase(),
      modalidad.value.toLowerCase(),
      disenoCurricular.value,
      requisitos.value.toLowerCase(),
      version.value.toLowerCase(),
      nivelId.value,
      red.value
    )
    .then(() => {
      ok();
      closeModal();
      buscarPrograma();
    })
    .catch((err) => {
      if (err.response && err.response.data.errors) {
        alert.value = true;
        errores.value = err.response.data.errors[0].msg;
        alerta();
      } else if (err.response && err.response.data.msg) {
        alert.value = true;
        errores.value = err.response.data.msg;
        alerta();
      } else if (err.response.data.error) {
        alert.value = true;
        errores.value = "Falta el archivo";
        alerta();
      }
    });
  }
}

async function cambiarEstado(p) {
  if (p.estado === true) {
    p.estado = false;
  } else {
    p.estado = true;
  }
  await usePrograma
    .cambiarEstado(p._id, p.estado)
    .then(() => {
      console.log("Cambio exitoso");
    })
    .catch((err) => {
      console.log(err);
    });
}

function limpiar() {
  (id.value = ""),
    (codigo.value = ""),
    (nombre.value = ""),
    (modalidad.value = ""),
    (disenoCurricular.value = ""),
    (requisitos.value = ""),
    (version.value = ""),
    (nivelId.value = ""),
    (usuarioId.value = ""),
    (ambienteId.value = "");
}

function ok() {
  Swal.fire({
    position: "center",
    icon: "success",
    title: "Cambios guardados",
    showConfirmButton: false,
    timer: 1500,
  });
}

function closeModal() {
  document.getElementById("close").click();
  document.getElementById("close1").click();
}

function alerta() {
  setTimeout(() => {
    alert.value = false;
    errores.value = "";
  }, 3000);
}

onMounted(async () => {
  setDocumentTitle();
  await buscarPrograma(), await traigodatos();
});

import { useConfiguracionStore } from "../stores/configuracion.js";
const useConfiguracion = useConfiguracionStore();
let coloroficialmenu = ref();
let coloroficialletra = ref();
let coloroficialtres = ref();
let coloroficialcuatro = ref();
async function traigodatos() {
  await useConfiguracion
    .traerConfiguracion()
    .then((resultado) => {
      coloroficialmenu.value = resultado[0].colormenu;
      coloroficialletra.value = resultado[0].colorletra;
      coloroficialtres.value = resultado[0].colortres;
      coloroficialcuatro.value = resultado[0].colorcuatro;
    })
    .catch((error) => {
      console.error("Hubo un error:", error);
    });
}
</script>

<style scoped>
.inputbuscar {
  width: 20%;
  height: 40px;
  margin-left: 7%;
}

.botonguardar {
  position: relative;
  left: 58%;
  background-color: v-bind(coloroficialmenu);
  color: v-bind(coloroficialtres);
}

.buscar img {
  width: 40px;
  position: relative;
  margin: 5px;
  bottom: 2px;
  padding: 10px;
  border-radius: 5px;
  background-color: rgb(227, 227, 227);
}

.titulo {
  margin-top: 3%;
  text-align: center;
  color: v-bind(coloroficialletra);
  font-weight: 1000;
  font-size: 45px;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  font-weight: 700;
  margin-right: 5%;
}

.titulogo {
  padding: 2rem;
  display: flex;
  justify-content: center;
  align-content: center;
  text-align: center;
  margin-top: 70px;
  background-color: rgb(243, 243, 247);
}

.logo {
  height: 70px;
  width: 70px;
}

table thead tr th {
  text-transform: capitalize;
  background-color: v-bind(coloroficialmenu);
  color: v-bind(coloroficialtres);
}

table tbody tr td {
  text-transform: capitalize;
}

span {
  display: grid;
}

select {
  width: 80%;
}

.table-container {
  width: 90%;
  margin-top: 1%;
  margin-left: 110px;
  margin-right: 90px;
  overflow-y: auto;
  max-height: 350px;
}

.modal {
  border-radius: 5px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
}

.modal-body span {
  text-transform: capitalize;
  font-weight: bold;
}

.modal-body input,
select {
  text-transform: capitalize;
  width: 100%;
  padding: 7px;
  margin-bottom: 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
}

.modal-header {
  background-color: v-bind(coloroficialmenu);
  /* Color de fondo del encabezado */
  color: v-bind(coloroficialtres);
  border-bottom: none;
  padding: 15px;
}

.modal-footer button {
  margin: 0 25px;
}

input[type="file"]#disenoCurricular {
  width: 0.1px;
  height: 0.1px;
  opacity: 0;
  overflow: hidden;
  position: absolute;
  z-index: -1;
}

label[for="disenoCurricular"] {
  font-size: 14px;
  font-weight: 600;
  color: #fff;
  background-color: v-bind(coloroficialmenu);
  display: inline-block;
  transition: all 0.5s;
  cursor: pointer;
  padding: 15px 40px !important;
  text-transform: uppercase;
  width: fit-content;
  text-align: center;
  margin: 0 10px;
  border-radius: 5px;
}

@media (max-width: 768px) {
  .botonguardar {
    position: relative;
    left: 15%;
  }

  .inputbuscar {
    width: 40%;
    height: 40px;
  }

  .titulo {
    font-size: 25px;
  }
}

@media (max-width: 391px) {
  .botonguardar {
    position: relative;
    left: 10%;
  }

  .inputbuscar {
    width: 45%;
    height: 40px;
    position: relative;
    right: 22px;
  }

  .imageninput {
    width: 30px;
    height: 30px;
    position: relative;
    right: 22px;
  }

  .table-container {
    position: relative;
    right: 16%;
    width: 135%;
    margin-top: 5%;
    overflow-y: auto;
    max-height: 350px;
  }
}
</style>

